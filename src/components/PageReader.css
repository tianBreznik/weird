/* Show white screen with message when in landscape mode - hide all content */
@media screen and (orientation: landscape) and (max-width: 768px) {
  html, body {
    width: 100vw !important;
    height: 100vh !important;
    overflow: hidden !important;
    position: fixed !important;
    background: #ffffff !important;
  }
  
  html::before {
    content: 'Please keep portrait';
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 99999;
    color: #ff0000;
    font-size: 1.5rem;
    font-weight: bold;
    text-align: center;
    white-space: nowrap;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }
  
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: #ffffff;
    z-index: 99998;
  }
  
  #root,
  #root > * {
    display: none !important;
    visibility: hidden !important;
  }
}

.page-reader {
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  background: transparent;
  z-index: 1;
  color: #1f140a;
  font-family: 'Baskerville Old Face', 'Baskerville', 'Garamond', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif;
  /* Force own compositing layer to preserve rendering */
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  will-change: transform;
  /* Prevent any scrolling on the page-frame */
  touch-action: none;
  -webkit-overflow-scrolling: none;
  /* Prevent pull-to-refresh */
  overscroll-behavior-y: none;
  overscroll-behavior: none;
}

.page-container {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 2rem 1rem 0.5rem; /* Reduced left/right padding from 1.5rem to 1rem */
  box-sizing: border-box;
  overflow: hidden;
  /* Force own compositing layer that persists during overlays */
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  will-change: transform;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  isolation: isolate;
  /* Prevent scrolling */
  touch-action: none;
}

/* Remove transform/isolation for background video pages and field notes pages so fixed positioning works relative to viewport */
.page-container:has(.background-video-page),
.page-container:has(.field-notes-page) {
  transform: none;
  -webkit-transform: none;
  isolation: auto;
}

/* Remove padding for video pages and field notes pages */
.page-container:has(.video-page),
.page-container:has(.field-notes-page) {
  padding: 0;
}

/* Allow background videos and field notes to break out of page-container */
.page-container:has(.background-video-page),
.page-container:has(.field-notes-page) {
  overflow: visible;
  /* Keep original padding and width - video/field notes break out via position: fixed */
}

/* Background video breaks out via position: fixed - no need to change page-sheet width */

.page-sheet {
  width: min(640px, 94vw);
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1.2rem;
  text-align: center;
  font-family: 'Baskerville Old Face', 'Baskerville', 'Iowan Old Style', 'Garamond', 'Cormorant Garamond', serif;
  color: #1b1209;
  /* Lock layout to prevent re-measurement during overlays */
  contain: layout style;
  min-width: 0;
  max-width: min(640px, 94vw);
  box-sizing: border-box;
}

.page-sheet.content-page {
  align-items: flex-start;
  gap: 0.4rem;
  text-align: left;
  width: min(680px, 96vw); /* Slightly wider since we reduced padding */
  /* Lock layout to prevent re-measurement during overlays */
  contain: layout style;
  min-width: 0;
  max-width: min(680px, 96vw);
  box-sizing: border-box;
}

/* Adjust for very small screens (iPhone SE, etc.) to prevent overflow */
@media screen and (max-width: 400px) {
  .page-container {
    padding: 1.5rem 0.75rem 0.5rem; /* Reduce top padding from 2rem to 1.5rem, and horizontal padding on very small screens */
  }
  
  .page-sheet.content-page {
    width: min(680px, calc(100vw - 1.5rem)); /* Account for reduced padding */
    max-width: min(680px, calc(100vw - 1.5rem));
  }
  
  .page-sheet {
    width: min(640px, calc(100vw - 1.5rem));
    max-width: min(640px, calc(100vw - 1.5rem));
  }
  
  /* Reduce top padding on page-body to fit more content on short screens */
  .content-page.page-with-heading .page-body,
  .content-page.page-without-heading .page-body {
    padding-top: calc(2.5rem + env(safe-area-inset-top)); /* Reduced from 3.5rem to 2.5rem */
  }
}

/* iPhone SE specific: Reduce top padding and line-height to prevent overflow when karaoke starts */
/* iPhone SE has screen height of 667px (375px Ã— 667px in portrait) */
/* We need to account for layout changes when karaoke word spans are added during initialization */
@media screen and (max-height: 667px) and (max-width: 400px) {
  /* Reduce top padding on page-body to move content up */
  .content-page.page-with-heading .page-body,
  .content-page.page-without-heading .page-body {
    /* Reduce by approximately half a line height (0.8rem) */
    padding-top: calc(1.7rem + env(safe-area-inset-top)) !important; /* Reduced from 2.5rem to 1.7rem */
  }
  
  /* Reduce line-height for karaoke text to have less gap between lines */
  .page-content .karaoke-slice,
  .page-content .karaoke-player {
    line-height: 1.28 !important; /* Reduced from 1.35 to 1.28 */
  }
  
  /* Also reduce line-height for paragraphs containing karaoke */
  .page-content p:has(.karaoke-slice),
  .page-content p:has(.karaoke-player) {
    line-height: 1.28 !important;
  }
  
  /* Pull karaoke paragraphs up slightly to compensate for layout shift */
  .page-content p:has(.karaoke-slice),
  .page-content p:has(.karaoke-player) {
    margin-top: -0.15rem !important;
  }
}

/* Additional fallback for iPhone SE using exact dimensions */
@media screen and (height: 667px) and (width: 375px) {
  .content-page.page-with-heading .page-body,
  .content-page.page-without-heading .page-body {
    padding-top: calc(1.7rem + env(safe-area-inset-top)) !important;
  }
  
  .page-content .karaoke-slice,
  .page-content .karaoke-player {
    line-height: 1.28 !important;
  }
  
  .page-content p:has(.karaoke-slice),
  .page-content p:has(.karaoke-player) {
    line-height: 1.28 !important;
    margin-top: -0.15rem !important;
  }
}

/* Keep text content constrained even with background video - video breaks out via position: fixed */

.page-header {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 0.45rem;
  text-align: center;
  color: #16100a;
}

.page-title {
  font-size: clamp(2.15rem, 5vw, 2.8rem);
  letter-spacing: 0.04em;
  font-weight: 500;
}

.page-subtitle {
  font-size: clamp(0.95rem, 2.7vw, 1.15rem);
  letter-spacing: 0.18em;
  text-transform: uppercase;
  color: #534b3b;
}

.page-author {
  font-size: clamp(1rem, 2.8vw, 1.2rem);
  font-style: italic;
  color: #3c3427;
}

.page-ampersand {
  font-size: 2.1rem;
  color: #40392f;
  margin-top: 0.1rem;
}

.page-body {
  width: 100%;
  flex: 1;
  line-height: 1.62;
  font-size: 1.18rem;
  letter-spacing: 0.006em;
  padding: 0.5rem 0 0 0;
  position: relative;
  overflow: hidden;
  /* Prevent scrolling */
  touch-action: none;
  -webkit-overflow-scrolling: none;
}


.content-page .page-body {
  text-align: left; /* Left-align like in the image */
  word-spacing: normal;
  hyphens: auto;
  -webkit-hyphens: auto;
  -moz-hyphens: auto;
  hyphenate-limit-chars: 6 3 2; /* min word length, min before hyphen, min after */
  position: relative; /* Allow absolute positioning of footnotes within page-body */
}

.content-page.page-with-heading .page-body {
  padding-top: calc(3.5rem + env(safe-area-inset-top)); /* Increased to account for top bar when title wraps */
  padding-bottom: env(safe-area-inset-bottom);
}

.content-page.page-without-heading .page-body {
  padding-top: calc(3.5rem + env(safe-area-inset-top)); /* Increased to account for top bar when title wraps */
  padding-bottom: env(safe-area-inset-bottom);
}

.content-body::before {
  display: none;
}

.page-content {
  overflow-x: hidden; /* Prevent horizontal overflow from tex-linebreak */
  overflow-y: hidden; /* Hide overflow at page boundaries (for inline footnotes) */
  width: 100%;
  font-family: 'Baskerville Old Face', 'Baskerville', 'Times New Roman', 'Times', 'Garamond', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif;
  font-size: 1.18rem; /* Fixed font size - never dynamic */
  line-height: 1.62; /* Fixed line height - never dynamic */
  word-spacing: normal;
  letter-spacing: 0.006em; /* Match page-body letter-spacing */
  /* Prevent layout shifts from overlays */
  contain: layout style;
  /* Lock dimensions to prevent re-measurement */
  min-width: 0;
  max-width: 100%;
  box-sizing: border-box;
  /* Don't create positioning context - footnotes position relative to page-body */
  padding-bottom: 0; /* No padding, footnotes will be absolutely positioned */
  height: 90%; /* Fill parent height */
  max-height: 95%; /* Ensure content doesn't exceed parent height */
  position: relative; /* Create clipping context */
}

.page-content * {
  font-size: inherit; /* All child elements inherit the same fixed font size */
  font-family: 'Times New Roman', 'Times', 'Garamond', 'Baskerville', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif !important; /* Force Times New Roman on all elements */
}

/* Ink effect for irregular shadows - JavaScript applies via .ink-char-mobile spans */
.ink-char-mobile {
  display: inline;
  font: inherit;
  color: inherit;
  line-height: inherit;
  letter-spacing: inherit;
  word-spacing: inherit;
  /* Preserve rendering during overlays */
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
}

.ink-char-mobile[data-ink="1"] {
  /* Very subtle, blurred ink bleed effect - more frequent but gentler */
  /* Use !important to ensure shadows persist during transitions and overlays */
  text-shadow:
    0 0 0.3px currentColor,
    0 0.08px 0.4px rgba(0, 0, 0, 0.15),
   -0.08px 0 0.4px rgba(0, 0, 0, 0.15) !important;
  -webkit-text-stroke: 0.04px currentColor !important;
  /* Force hardware acceleration and preserve rendering */
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  will-change: text-shadow;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

/* Exclude chapter and subchapter headings from Times New Roman */
.page-content .chapter-header-title,
.page-content h3.chapter-header-title,
.page-content h4.chapter-header-title {
  font-family: 'Baskerville Old Face', 'Baskerville', 'Garamond', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif !important; /* Keep original font for headings - override universal rule */
}

.page-content-main {
  width: 100%;
  padding-bottom: 0; /* Will be set dynamically via inline style */
  overflow-x: hidden; /* Prevent horizontal overflow from tex-linebreak adjustments */
  overflow-y: hidden; /* Hide overflow at page boundaries (for inline footnotes) */
  box-sizing: border-box;
  max-height: 100%; /* Ensure content doesn't exceed parent height */
}

/* Link styling - standard web link appearance */
.page-content a {
  color: #0066cc;
  text-decoration: underline;
  cursor: pointer;
}

.page-content a:hover {
  color: #0052a3;
  text-decoration: underline;
}

.page-content a:visited {
  color: #551a8b;
}

/* Links in background video pages should be visible */
.background-video-text a {
  color: #66b3ff !important;
  text-decoration: underline !important;
}

.background-video-text a:hover {
  color: #99ccff !important;
}

/* Default chapter body style (canonical reading style)
   - Approx 18px text
   - Tight line-height (~1.2)
   - Compact vertical rhythm between paragraphs
*/
.page-content p {
  font-size: 1.3rem;           /* ~20.8px at 16px root - increased for better mobile readability */
  line-height: 1.35;           /* Increased from 1.2 for better readability and less text density */
  margin: 0.35rem 0;           /* Reduced margin for tighter paragraph spacing */
  text-align: justify;          /* Justified text by default for book-like appearance */
  text-align-last: left;        /* Last line left-aligned (professional typesetting standard) */
  text-justify: inter-word;     /* Use inter-word justification */
  word-spacing: -0.08em;        /* Slight negative word spacing to reduce gaps */
  letter-spacing: 0.01em;       /* Slight letter spacing to help distribute space */
  hyphens: auto;                /* Enable hyphenation to reduce gaps */
  -webkit-hyphens: auto;
  min-height: 0.45rem;          /* Ensure empty paragraphs still create spacing */
}

/* Ensure empty paragraphs create visible spacing */
.page-content p:empty,
.page-content p:has(> br:only-child) {
  min-height: 0.7rem;           /* Slightly more than margin for empty paragraphs */
  display: block;                /* Ensure block display */
}

/* Respect inline text-align styles from TipTap (center, left, right) */
.page-content p[style*="text-align: center"],
.page-content p[style*="text-align:center"] {
  text-align: center !important;
  text-align-last: center !important;
  text-justify: auto !important;
  word-spacing: normal !important;
}

.page-content p[style*="text-align: left"],
.page-content p[style*="text-align:left"] {
  text-align: left !important;
  text-align-last: left !important;
  text-justify: auto !important;
  word-spacing: normal !important;
}

.page-content p[style*="text-align: right"],
.page-content p[style*="text-align:right"] {
  text-align: right !important;
  text-align-last: right !important;
  text-justify: auto !important;
  word-spacing: normal !important;
}

.page-content p {
  overflow-wrap: break-word;    /* Allow breaking long words */
  word-wrap: break-word;        /* Legacy support for word breaking */
  max-width: 100%;              /* Ensure paragraphs don't overflow container */
  box-sizing: border-box;       /* Include padding in width calculation */
  font-family: 'Times New Roman', 'Times', 'Garamond', 'Baskerville', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif !important; /* Explicit font for paragraphs */
  /* Subtle text shadow for grainy/furry typewriter aesthetic - mobile only */
}

/* Karaoke paragraphs should also be justified, but disable hyphenation to preserve highlighting */
.page-content p:has(.karaoke-slice),
.page-content p:has(.karaoke-player) {
  text-align: justify !important;
  text-align-last: left !important;
  text-justify: inter-word !important;
  word-spacing: -0.08em !important;
  letter-spacing: 0.01em !important;
  /* Use ONLY programmatic hyphenation (soft hyphens from hyphenateSync)
     Do NOT use hyphens: auto - it conflicts with soft hyphens and causes
     visual glitches where hyphen positions change after DOM rebuild.
     Soft hyphens (\u00AD) work independently and are always respected. */
  hyphens: none !important;
  -webkit-hyphens: none !important;
  -moz-hyphens: none !important;
}

@media (max-width: 768px) {
  .page-content p {
    text-shadow: 0 0.6px 1.2px rgba(0, 0, 0, 0.15), 0 0.4px 0.8px rgba(0, 0, 0, 0.12);
  }
  
  /* Apply shadow to other content elements but exclude subchapter titles */
  .page-content h1,
  .page-content h2,
  .page-content h3:not(.chapter-header-title),
  .page-content h5,
  .page-content h6,
  .page-content li,
  .page-content blockquote,
  .page-content span:not(.ink-char-mobile) {
    text-shadow: 0 0.6px 1.2px rgba(0, 0, 0, 0.15), 0 0.4px 0.8px rgba(0, 0, 0, 0.12);
  }
  
  /* Subchapter titles (h4) should have shadows like other content */
}

.page-content p.para-intro {
  /* Subtle intro/lead paragraph style: slightly more air and light emphasis */
  margin-top: 0.9rem;
  margin-bottom: 0.9rem;
  font-style: italic;
}

.page-content p.para-whisper {
  /* Whisper/aside: a bit smaller, indented and softened */
  font-size: 0.9em;
  line-height: 1.4;
  font-style: italic;
  color: #777;
  opacity: 0.95;
  margin-top: 0.3em;
  margin-bottom: 0.3em;
}

.page-content p.para-epigraph {
  /* Epigraph paragraph style (legacy, for paragraphs in content) */
  text-align: center;
  font-style: italic;
  font-size: 3.95em;
  line-height: 1.5;
  color: #555;
  margin-top: 1.5em;
  margin-bottom: 1.5em;
  padding: 0 1em;
}

/* Dinkus styling */
.page-content div.dinkus,
.page-content p.dinkus {
  text-align: center;
  margin: 0.5rem 0;
}

.page-content .dinkus-image {
  max-width: 40px;
  width: auto;
  height: auto;
  display: block;
  margin: 0 auto;
}

/* Epigraph page styling */
.epigraph-page .page-body {
  display: flex;
  /* Push epigraph block toward the bottom of the frame */
  align-items: flex-end;
  justify-content: flex-start;
  text-align: center;
  padding-bottom: 11.5rem; /* lift it slightly above the very bottom edge */
  padding-left: 8rem;
}

.epigraph-content {
  width: 100%;
  display: flex;
  /* Anchor block on the left side */
  align-items: flex-end;
  justify-content: flex-start;
  padding: 0 1.5rem;
  box-sizing: border-box;
}

.epigraph-text {
  font-family: 'Baskerville Old Face', 'Baskerville', 'Garamond', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif;
  font-size: 1.2rem;
  line-height: 1.2;
  font-style: italic;
  color: #1f140a;
  max-width: 100%;
  white-space: pre-wrap;
  text-align: left;
}

.epigraph-text > div {
  white-space: pre-wrap;
}

.epigraph-author {
  margin-top: 0.35rem;
  font-size: 0.95rem;
  font-style: normal;
  text-align: right;
}

.epigraph-align-left {
  text-align: left;
}

.epigraph-align-center {
  text-align: center;
}

.epigraph-align-right {
  text-align: right;
}

/* Cover page styling */
.cover-page .page-body {
  display: flex;
  align-items: flex-start;
  justify-content: flex-start;
  padding: 0;
  box-sizing: border-box;
  position: relative;
}

.cover-content {
  width: 100%;
  height: 100%;
  position: relative;
  padding: 2rem;
  box-sizing: border-box;
  /* Override any page-content constraints */
  max-width: 100% !important;
  min-width: 100% !important;
}

.cover-title {
  position: absolute;
  top: 12%;
  left: 50%;
  transform: translateX(-50%);
  margin: 0;
  width: 98%;
  max-width: none;
  z-index: 2;
  text-align: center;
}

.cover-title-image {
  width: 100%;
  height: auto;
  display: block;
  margin: 0 auto;
}

.cover-author {
  position: absolute;
  bottom: 20%;
  left: 8%;
  font-family: 'Baskerville Old Face', 'Baskerville', 'Garamond', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif;
  font-size: 1rem;
  color: #1f140a;
  text-align: left;
  margin: 0;
  z-index: 2;
  text-shadow:
    0 0 0.5px rgba(0,0,0,0.45),
    0 0.1px 0.6px rgba(0,0,0,0.35),
    0 0.2px 0.9px rgba(0,0,0,0.3),
   -0.1px 0 0.6px rgba(0,0,0,0.35),
   -0.2px 0 0.9px rgba(0,0,0,0.3),
    0.1px 0.1px 0.75px rgba(0,0,0,0.3),
    0.075px 0.075px 0.6px currentColor,
   -0.075px 0.075px 0.6px currentColor,
    0.075px -0.075px 0.6px currentColor;
  -webkit-text-stroke: 0.125px rgba(0,0,0,0.25);
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  font-kerning: normal;
  font-variant-ligatures: common-ligatures;
}

.cover-illustration {
  position: absolute;
  bottom: 20%;
  right: 15%;
  width: 35%;
  max-width: 180px;
  z-index: 1;
}

.cover-feathers-image {
  width: 100%;
  height: auto;
  display: block;
}

/* Video page styling - break out of container to cover full screen */
.video-page {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  width: 100vw !important;
  height: 100vh !important;
  max-width: 100vw !important;
  padding: 0 !important;
  margin: 0 !important;
  align-items: stretch;
  z-index: 1;
}

.video-page .page-body {
  padding: 0;
  overflow: hidden;
  position: relative;
  width: 100vw;
  height: 100vh;
  flex: 1;
  min-height: 0;
}

.video-content {
  width: 100vw;
  height: 100vh;
  position: relative;
  padding: 0;
  margin: 0;
  flex: 1;
  min-height: 0;
}

.fullscreen-video {
  width: 100vw;
  height: 100vh;
  object-fit: cover;
  position: absolute;
  top: 0;
  left: 0;
  z-index: 0;
}

/* Video play button - glowing text with floating animation */
.video-play-button {
  position: fixed !important;
  top: 50% !important;
  left: 50% !important;
  transform: translate(-50%, -50%);
  background: transparent;
  border: none;
  color: white;
  font-size: 1.5rem;
  font-weight: 300;
  letter-spacing: 0.1em;
  display: flex !important;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 9999 !important;
  transition: all 0.3s ease;
  padding: 0;
  opacity: 0.9;
  text-shadow: 
    0 0 10px rgba(255, 255, 255, 0.8),
    0 0 20px rgba(255, 255, 255, 0.6),
    0 0 30px rgba(255, 255, 255, 0.4);
  animation: float 3s ease-in-out infinite;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  pointer-events: auto !important;
  visibility: visible !important;
}

@keyframes float {
  0%, 100% {
    transform: translate(-50%, -50%) translateY(0px);
  }
  50% {
    transform: translate(-50%, -50%) translateY(-8px);
  }
}

.video-play-button:hover {
  opacity: 1;
  text-shadow: 
    0 0 15px rgba(255, 255, 255, 1),
    0 0 25px rgba(255, 255, 255, 0.8),
    0 0 35px rgba(255, 255, 255, 0.6);
}

.video-play-button:active {
  transform: translate(-50%, -50%) translateY(-4px) scale(0.95);
}

/* Background video page styling */
.background-video-page .page-body {
  position: relative;
  overflow: visible; /* Allow video to break out */
  width: 100%;
  height: 100%;
}

.background-video {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  width: 100vw !important;
  height: 100vh !important;
  min-width: 100vw !important;
  min-height: 100vh !important;
  max-width: none !important;
  max-height: none !important;
  object-fit: cover;
  z-index: 0;
  pointer-events: none; /* Allow clicks to pass through to content */
  margin: 0 !important;
  padding: 0 !important;
}

.background-video-text {
  position: relative;
  z-index: 1;
  color: #ffffff;
}

.background-video-text * {
  color: #ffffff !important;
}

.background-video-text p,
.background-video-text h3,
.background-video-text h4,
.background-video-text h5,
.background-video-text h6 {
  color: #ffffff !important;
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
}

.page-content div.poetry {
  /* Poetry: centered, preserves line breaks, treated as atomic for pagination */
  text-align: center;
  font-style: italic;
  margin: 0.8em 0;
  padding: 0 1em;
}

.page-content div.poetry p {
  margin: 0.3em 0;
  line-height: 1.6;
}

.page-content p:last-child {
  margin-bottom: 0;
}

.page-content ul,
.page-content ol {
  padding-left: 1.4rem;
  margin: 0.45rem 0;           /* Match compact paragraph rhythm */
}

.page-content li {
  font-size: 1.125rem;
  line-height: 1.2;
  margin-bottom: 0.35rem;
}

/* Blockquote styling - book-like with left border and italic text */
.page-content blockquote {
  font-size: 1.125rem;
  line-height: 1.4;
  margin: 0.75rem 0;
  padding-left: 1.5rem;
  border-left: 3px solid #8b8b8b;
  font-style: italic;
  color: #3a3a3a;
  font-family: 'Times New Roman', 'Times', 'Garamond', 'Baskerville', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif !important;
}

/* Drop cap styling - first letter larger */
.page-content p.drop-cap {
  /* Ensure the paragraph itself is block-level for ::first-letter to work */
  display: block;
}

.page-content p.drop-cap::first-letter {
  float: left;
  font-size: 3rem !important;
  line-height: 0.82 !important;
  padding-right: 0.22rem;
  padding-top: 0.08rem;
  font-weight: 400 !important;
  font-family: 'Times New Roman', 'Times', 'Garamond', 'Baskerville', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif !important;
  /* Override any inline styles on the first letter */
  color: inherit !important;
  text-transform: none !important;
}

/* Image alignment and text wrapping */
.page-content img {
  max-width: 100%;
  height: auto;
}

/* Center aligned images (default) - block, no wrap */
.page-content img[data-align="center"] {
  display: block;
  margin: 0.5em auto;
  float: none !important;
}

/* Images without data-align should also be centered */
.page-content img:not([data-align]) {
  display: block;
  margin: 0.5em auto;
  float: none !important;
}

/* Left aligned images - float left, text wraps right */
.page-content img[data-align="left"] {
  float: left !important;
  margin-right: 1em !important;
  margin-bottom: 0.5em !important;
  margin-top: 0.5em !important;
  display: block !important;
}

/* Right aligned images - float right, text wraps left */
.page-content img[data-align="right"] {
  float: right !important;
  margin-left: 1em !important;
  margin-bottom: 0.5em !important;
  margin-top: 0.5em !important;
  display: block !important;
}

/* Inline images - flow with text like an emoji or icon */
.page-content img[data-align="inline"] {
  display: inline-block;
  vertical-align: middle;
  margin: 0 0.25em;
  /* Remove any block-level spacing that might break line flow */
  margin-top: 0;
  margin-bottom: 0;
  /* Note: Best for small images (icons, emojis). Large images will break line flow naturally. */
}

/* Inline image node - true inline images that flow with text */
.page-content img[data-inline="true"] {
  display: inline-block !important;
  vertical-align: middle !important;
  /* Match surrounding text size: 1em relative to current font-size */
  max-height: 1em !important;
  width: auto !important;
  height: auto !important;
  margin: 0 0.25em !important;
  margin-top: 0 !important;
  margin-bottom: 0 !important;
  /* Ensure it doesn't break line flow */
  float: none !important;
  clear: none !important;
}

/* Clear floats after images to prevent layout issues */
.page-content::after {
  content: "";
  display: table;
  clear: both;
}

/* Indented paragraphs */
.page-content p[data-indent],
.page-content h1[data-indent],
.page-content h2[data-indent],
.page-content h3[data-indent] {
  /* Indent is applied via inline style from TipTap */
  display: block;
}

/* Chapter title styling (h3) - bold, centered by default, with shadows */
/* Only apply default center alignment if no inline text-align style is present */
.page-content .chapter-header-title:not([style*="text-align"]),
.page-content h3.chapter-header-title:not([style*="text-align"]),
.page-content h3:not([data-indent]):not([style*="text-align"]) {
  margin: 1.5rem 0 1rem 0;
  font-size: 1.35rem;
  color: #0c0c0c;
  font-weight: bold;
  font-family: 'Baskerville Old Face', 'Baskerville', 'Garamond', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif;
  text-transform: none;
  letter-spacing: 0.015em;
  text-align: center; /* Default center, but client can change alignment in editor - overridden by inline styles */
  text-shadow: 0 0 0.9px rgba(0,0,0,0.5), 0 0 1.4px rgba(0,0,0,0.18);
  -webkit-text-stroke: 0.2px rgba(0,0,0,0.22);
}

/* Ensure headings with inline text-align styles preserve their alignment */
.page-content h1[style*="text-align"],
.page-content h2[style*="text-align"],
.page-content h3[style*="text-align"],
.page-content h4[style*="text-align"],
.page-content h5[style*="text-align"],
.page-content h6[style*="text-align"] {
  /* Inline styles have highest specificity, but ensure they're not overridden */
  text-shadow: 0 0 0.9px rgba(0,0,0,0.5), 0 0 1.4px rgba(0,0,0,0.18);
  -webkit-text-stroke: 0.2px rgba(0,0,0,0.22);
}

/* Respect inline text-align styles for headings from TipTap - must come after default rules */
/* Use attribute selectors to match inline styles - these have higher specificity than class selectors */
/* TipTap outputs: style="text-align: left" (with space) */
/* Inline styles have highest specificity, but we add !important rules below to ensure they override default center */

/* Specific overrides for each alignment value - using !important to ensure they override default center */
.page-content h1[style*="text-align: center"],
.page-content h1[style*="text-align:center"],
.page-content h2[style*="text-align: center"],
.page-content h2[style*="text-align:center"],
.page-content h3[style*="text-align: center"],
.page-content h3[style*="text-align:center"],
.page-content h3.chapter-header-title[style*="text-align: center"],
.page-content h3.chapter-header-title[style*="text-align:center"],
.page-content .chapter-header-title[style*="text-align: center"],
.page-content .chapter-header-title[style*="text-align:center"],
.page-content h3:not([data-indent])[style*="text-align: center"],
.page-content h3:not([data-indent])[style*="text-align:center"],
.page-content h4[style*="text-align: center"],
.page-content h4[style*="text-align:center"],
.page-content h5[style*="text-align: center"],
.page-content h5[style*="text-align:center"],
.page-content h6[style*="text-align: center"],
.page-content h6[style*="text-align:center"] {
  text-align: center !important;
}

.page-content h1[style*="text-align: left"],
.page-content h1[style*="text-align:left"],
.page-content h2[style*="text-align: left"],
.page-content h2[style*="text-align:left"],
.page-content h3[style*="text-align: left"],
.page-content h3[style*="text-align:left"],
.page-content h3.chapter-header-title[style*="text-align: left"],
.page-content h3.chapter-header-title[style*="text-align:left"],
.page-content .chapter-header-title[style*="text-align: left"],
.page-content .chapter-header-title[style*="text-align:left"],
.page-content h3:not([data-indent])[style*="text-align: left"],
.page-content h3:not([data-indent])[style*="text-align:left"],
.page-content h4[style*="text-align: left"],
.page-content h4[style*="text-align:left"],
.page-content h5[style*="text-align: left"],
.page-content h5[style*="text-align:left"],
.page-content h6[style*="text-align: left"],
.page-content h6[style*="text-align:left"] {
  text-align: left !important;
}

.page-content h1[style*="text-align: right"],
.page-content h1[style*="text-align:right"],
.page-content h2[style*="text-align: right"],
.page-content h2[style*="text-align:right"],
.page-content h3[style*="text-align: right"],
.page-content h3[style*="text-align:right"],
.page-content h3.chapter-header-title[style*="text-align: right"],
.page-content h3.chapter-header-title[style*="text-align:right"],
.page-content .chapter-header-title[style*="text-align: right"],
.page-content .chapter-header-title[style*="text-align:right"],
.page-content h3:not([data-indent])[style*="text-align: right"],
.page-content h3:not([data-indent])[style*="text-align:right"],
.page-content h4[style*="text-align: right"],
.page-content h4[style*="text-align:right"],
.page-content h5[style*="text-align: right"],
.page-content h5[style*="text-align:right"],
.page-content h6[style*="text-align: right"],
.page-content h6[style*="text-align:right"] {
  text-align: right !important;
}

.page-content .chapter-header-title::first-letter,
.page-content h3.chapter-header-title::first-letter {
  text-transform: uppercase;
}

/* Subchapter title styling (h4) - normal weight, left-aligned by default, with shadows */
.page-content h4.chapter-header-title,
.page-content h4 {
  font-size: 1.05rem;
  margin: 1.2rem 0 0.8rem 0;
  font-weight: normal;
  font-family: 'Baskerville Old Face', 'Baskerville', 'Garamond', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif;
  text-align: left; /* Default left, but client can change alignment in editor */
  text-shadow: 0 0 0.9px rgba(0,0,0,0.5), 0 0 1.4px rgba(0,0,0,0.18);
  -webkit-text-stroke: 0.2px rgba(0,0,0,0.22);
  color: #0c0c0c;
}

/* Fade transition - smoother and slower */
.page-container .page-sheet {
  opacity: 1;
  transition: opacity 1s ease-in-out;
  will-change: opacity; /* Optimize for opacity transitions */
  /* Preserve text shadows during overlays - create isolated compositing layer */
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
}

/* Remove transform for field notes pages so fixed positioning works relative to viewport */
.page-container .page-sheet.field-notes-page {
  transform: none !important;
  -webkit-transform: none !important;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  isolation: isolate;
  contain: layout style paint;
}

.page-container.transitioning .page-sheet {
  opacity: 0;
  transition: opacity 1s ease-in-out;
}

/* Preserve ink effect shadows during transition - ensure they fade with text */
/* Apply to all states to ensure consistency */
.page-container .page-sheet .ink-char-mobile[data-ink="1"],
.page-container.transitioning .page-sheet .ink-char-mobile[data-ink="1"] {
  /* Shadows must persist - use !important to override any other rules */
  /* These shadows will fade naturally with the parent's opacity transition */
  /* Match the base shadow values to ensure consistency */
  text-shadow:
    0 0 0.2px currentColor,
    0 0.06px 0.28px currentColor,
   -0.06px 0 0.28px currentColor !important;
  -webkit-text-stroke: 0.06px currentColor !important;
}

.page-reader-loading {
  display: block;
  height: 100vh;
  width: 100vw;
  position: fixed;
  top: 0;
  left: 0;
  z-index: 10000;
  background: #ffffff; /* Plain white background */
  font-family: 'Baskerville Old Face', 'Baskerville', 'Garamond', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif;
  color: #0a0a0a;
  font-size: 1rem;
  /* Ensure loading state is visible immediately */
  opacity: 1;
  visibility: visible;
  overflow: hidden;
}

.loading-gif {
  max-width: 200px;
  max-height: 200px;
  width: auto;
  height: auto;
  /* Preload the GIF to avoid delay */
  image-rendering: auto;
}

/* Page number in bottom right corner */
.page-number {
  position: fixed !important;
  /* Use fixed value for compatibility - older Safari may not support env() with calc() */
  /* Position it lower, near the bottom like the original (1rem from bottom, or 1rem + safe area) */
  bottom: 0.5rem !important;
  right: 1rem !important;
  font-family: 'Baskerville Old Face', 'Baskerville', 'Garamond', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif;
  font-size: 0.9rem;
  color: #1f140a !important;
  opacity: 0.6 !important; /* Restore original opacity */
  z-index: 99999 !important; /* Very high z-index to ensure it's on top */
  padding: 0.25rem 0.5rem;
  pointer-events: none;
  /* Ensure visibility on all devices */
  display: block !important;
  visibility: visible !important;
  /* Ensure it's not clipped */
  overflow: visible !important;
}

/* Use @supports to add safe area support for modern browsers */
@supports (bottom: env(safe-area-inset-bottom)) {
  .page-number {
    /* Add safe area inset to account for iPhone home indicator, etc. */
    bottom: calc(env(safe-area-inset-bottom) + 1rem);
  }
}

/* Desktop: hide page reader */
/* Karaoke highlighting styles */
.karaoke-slice .karaoke-char,
.karaoke-player .karaoke-char {
  /* Punctuation / special chars we attach to words.
     Keep them behaving like normal inline text so browser hyphenation
     can work exactly as for regular paragraphs. */
  position: static;
  display: inline;
  white-space: normal;
  margin: 0;
  padding: 0;
  border: 0;
  vertical-align: baseline;
  color: inherit;
  --karaoke-fill: 0;
  font: inherit;
  line-height: inherit;
  letter-spacing: inherit;
  /* Fluffy, scanned paper-like text shadow for karaoke text (ink effect disabled - see polish note in PageReader.jsx) */
  text-shadow: 
    0 0.2px 0.4px rgba(0, 0, 0, 0.3),
    0 0.3px 0.6px rgba(0, 0, 0, 0.28),
    0 0.4px 0.8px rgba(0, 0, 0, 0.25),
    0 0.5px 1px rgba(0, 0, 0, 0.22),
    0 0.6px 1.4px rgba(0, 0, 0, 0.2),
    0 0.8px 1.8px rgba(0, 0, 0, 0.18),
    0 1px 2.2px rgba(0, 0, 0, 0.15),
    0 1.2px 2.8px rgba(0, 0, 0, 0.12),
    0.1px 0.1px 0.4px rgba(0, 0, 0, 0.25),
    -0.1px -0.1px 0.4px rgba(0, 0, 0, 0.2);
  -webkit-text-stroke: 0.08px rgba(0, 0, 0, 0.15);
}

.karaoke-slice .karaoke-word,
.karaoke-player .karaoke-word {
  position: relative;
  display: inline;          /* inline allows soft hyphens to break (inline-block prevents it) */
  white-space: normal;       /* Normal wrapping & justification */
  word-break: normal;        /* Use default word-breaking */
  overflow-wrap: normal;
  margin: 0;
  padding: 0;
  border: 0;
  vertical-align: baseline;
  color: inherit;
  --karaoke-fill: 0;
  font: inherit;
  line-height: inherit;
  letter-spacing: inherit;
  /* Note: Changed from inline-block to inline to allow hyphenation. The ::after overlay
     uses position: absolute with min-width: 100% which should work with inline elements. */
  /* Fluffy, scanned paper-like text shadow for karaoke text (ink effect disabled - see polish note in PageReader.jsx) */
  text-shadow: 
    0 0.2px 0.4px rgba(0, 0, 0, 0.3),
    0 0.3px 0.6px rgba(0, 0, 0, 0.28),
    0 0.4px 0.8px rgba(0, 0, 0, 0.25),
    0 0.5px 1px rgba(0, 0, 0, 0.22),
    0 0.6px 1.4px rgba(0, 0, 0, 0.2),
    0 0.8px 1.8px rgba(0, 0, 0, 0.18),
    0 1px 2.2px rgba(0, 0, 0, 0.15),
    0 1.2px 2.8px rgba(0, 0, 0, 0.12),
    0.1px 0.1px 0.4px rgba(0, 0, 0, 0.25),
    -0.1px -0.1px 0.4px rgba(0, 0, 0, 0.2);
  -webkit-text-stroke: 0.08px rgba(0, 0, 0, 0.15);
}

.karaoke-slice .karaoke-char[data-ink="1"],
.karaoke-player .karaoke-char[data-ink="1"],
.karaoke-slice .karaoke-word[data-ink="1"],
.karaoke-player .karaoke-word[data-ink="1"] {
  text-shadow:
    0 0 0.8px rgba(0,0,0,0.5),
    0 0.25px 1px rgba(0,0,0,0.22),
   -0.25px 0 1px rgba(0,0,0,0.18);
  -webkit-text-stroke: 0.2px rgba(0,0,0,0.22);
}

.karaoke-slice .karaoke-char::after,
.karaoke-player .karaoke-char::after {
  content: attr(data-char);
  position: absolute;
  inset: 0;
  white-space: pre; /* Keep 'pre' to match character span positioning */
  color: transparent;
  pointer-events: none;
  opacity: var(--karaoke-fill);
  font: inherit;
  letter-spacing: inherit;
  line-height: inherit;
  font-weight: inherit;
  -webkit-text-stroke: 0.75px rgba(255, 214, 0, 0.95);
  text-shadow: none;
  transition: opacity 90ms linear;
}

.karaoke-slice .karaoke-word::after,
.karaoke-player .karaoke-word::after {
  content: attr(data-word);
  position: absolute;
  /* Use explicit positioning - for inline elements, we need to cover the full width */
  top: -0.05em; /* Move up slightly to align with text */
  left: 0;
  /* Use min-width: 100% to ensure full coverage on older Safari with inline elements */
  min-width: 100%;
  width: max-content; /* Allow the overlay to match the word width exactly */
  height: 100%;
  bottom: 0;
  /* Keep pre to match exact character positions - critical for accurate highlighting */
  white-space: pre;
  color: transparent;
  pointer-events: none;
  opacity: var(--karaoke-fill);
  font: inherit;
  letter-spacing: inherit;
  line-height: inherit;
  font-weight: inherit;
  -webkit-text-stroke: 0.75px rgba(255, 214, 0, 0.95);
  text-shadow: none;
  transition: opacity 90ms linear;
}


.karaoke-slice .karaoke-char.karaoke-char-complete,
.karaoke-slice .karaoke-char.karaoke-char-active,
.karaoke-player .karaoke-char.karaoke-char-complete,
.karaoke-player .karaoke-char.karaoke-char-active,
.karaoke-slice .karaoke-word.karaoke-word-complete,
.karaoke-slice .karaoke-word.karaoke-word-active,
.karaoke-player .karaoke-word.karaoke-word-complete,
.karaoke-player .karaoke-word.karaoke-word-active {
  color: inherit;
}

/* Breathing pulse animation for karaoke slices */
.karaoke-slice {
  cursor: pointer;
  display: inline-block;
  animation: karaoke-breathe 2s ease-in-out infinite;
  will-change: opacity;
  /* Match normal paragraph font metrics exactly */
  font-size: 1.3rem;
  line-height: 1.35;
  word-spacing: -0.08em;
  letter-spacing: 0.01em;
  /* Apply justified text alignment like regular paragraphs */
  text-align: justify;
  text-align-last: left;
  text-justify: inter-word;
  /* Use ONLY programmatic hyphenation (soft hyphens from hyphenateSync)
     Do NOT use hyphens: auto - it conflicts with soft hyphens and causes
     visual glitches where hyphen positions change after DOM rebuild.
     Soft hyphens (\u00AD) work independently and are always respected. */
  hyphens: none;
  -webkit-hyphens: none;
  -moz-hyphens: none;
  /* Ensure <br> tags are visible and functional - allow line breaks */
  white-space: normal;
}


/* Karaoke player wrapper - match normal paragraph font metrics exactly */
.karaoke-player {
  font-size: 1.3rem;
  line-height: 1.35;
  word-spacing: -0.08em;
  letter-spacing: 0.01em;
  /* Enable hyphenation like normal paragraphs */
  hyphens: auto;
  -webkit-hyphens: auto;
  -moz-hyphens: auto;
}

/* Note: line-height for karaoke with <br> tags kept at 1.35 to match normal paragraphs */

/* Reduce spacing between paragraphs in karaoke text (smaller than normal paragraph gap) */
.karaoke-slice br,
.karaoke-player br {
  display: block;
  margin: 0;
  padding: 0;
  line-height: 0.08rem; /* Very small line-height to minimize gap */
  height: 0.08rem; /* Explicit height for consistent spacing */
  font-size: 0.08rem; /* Small font size to minimize spacing */
}

/* Further reduce spacing by pulling content closer after breaks */
.karaoke-slice br + *,
.karaoke-player br + * {
  margin-top: -0.2rem; /* Increased negative margin to pull content closer after <br> */
  display: inline-block; /* Ensure negative margin works */
}

/* Prevent line breaks after word spans that contain punctuation */
.karaoke-word:has(.karaoke-punctuation) {
  white-space: nowrap !important;
}

/* Prevent line breaks before punctuation - ensure punctuation stays with previous word */
.karaoke-char.karaoke-punctuation {
  white-space: nowrap !important;
  display: inline !important;
}

/* Prevent orphaned punctuation at line start */
.karaoke-slice .karaoke-word + .karaoke-char.karaoke-punctuation,
.karaoke-player .karaoke-word + .karaoke-char.karaoke-punctuation {
  white-space: nowrap !important;
}

.karaoke-slice[data-playing="true"] {
  animation: none !important;
  opacity: 1 !important;
}

.karaoke-slice .karaoke-char {
  animation: inherit;
}

.karaoke-slice[data-playing="true"] .karaoke-char {
  animation: none !important;
}

@keyframes karaoke-breathe {
  0%, 100% {
    opacity: 0.35;
  }
  50% {
    opacity: 1;
  }
}

@media (min-width: 769px) {
  .page-reader {
    display: none;
  }
}

/* Footnote styles */
.footnote-ref {
  font-size: 0.75em;
  vertical-align: super;
  line-height: 0;
  cursor: pointer;
  color: #1f140a;
  text-decoration: none;
  margin-left: 0.1em;
}

.footnote-ref:hover {
  text-decoration: underline;
}

.footnotes-section {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  margin-top: 0;
  padding-top: 0;
  padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 2rem + 1rem); /* Account for browser bar on mobile + extra padding to lift footnotes up */
  margin-bottom: 0;
  border-top: none; /* Remove border-top, we use .footnotes-divider instead */
  background: inherit; /* Match page background */
  z-index: 1; /* Ensure footnotes are above content if needed */
}

.footnotes-divider {
  height: 1px;
  background: linear-gradient(to right, rgba(31, 20, 10, 0.3) 0%, rgba(31, 20, 10, 0.1) 100%);
  margin-bottom: 0.3rem;
  margin-top: 0;
}

.footnotes-list {
  font-size: 0.9rem;
  line-height: 1.5;
  color: #1f140a;
}

.footnote-item {
  margin-bottom: 0.3rem;
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
}

.footnote-item:last-child {
  margin-bottom: 0;
}

.footnote-number {
  font-weight: 500;
  flex-shrink: 0;
  min-width: 1.5em;
}

.footnote-content {
  flex: 1;
}

/* Inline Footnote Expansion */
.inline-footnote-container {
  display: block;
  width: 100%;
  margin-top: 0.5em; /* Reduced gap between text and footnote */
  margin-bottom: 0.25em;
}

.inline-footnote-divider {
  height: 1px;
  background: linear-gradient(to right, rgba(31, 20, 10, 0.3) 0%, rgba(31, 20, 10, 0.1) 100%);
  margin-bottom: 0.5em;
  width: 100%;
}

.inline-footnote {
  display: inline-block;
  font-size: 0.75em;
  line-height: 1.5;
  color: #1f140a;
  opacity: 0.85;
}

.inline-footnote-number {
  font-weight: 500;
  margin-right: 0.25em;
  font-style: normal; /* Number should not be italic */
}

/* Field Notes Pages - Scanned journal pages as background images */
/* Field notes pages should fill the entire viewport - use same approach as normal background images */

/* Make page-sheet full width for field notes and remove any transforms */
.content-page.field-notes-page {
  width: 100vw !important;
  max-width: 100vw !important;
  padding: 0 !important;
  margin: 0 !important;
  transform: none !important;
  -webkit-transform: none !important;
}

/* Remove all padding from page-body for field notes */
.content-page.field-notes-page .page-body {
  padding: 0 !important;
  margin: 0 !important;
}

.field-notes-content {
  width: 100%;
  height: 100%;
  padding: 0;
  margin: 0;
  position: relative;
}

.field-notes-page {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  width: 100vw;
  height: 100vh;
  background-size: cover;
  background-repeat: no-repeat;
  background-position: left center; /* Match normal background images */
  z-index: 0;
  pointer-events: none;
  margin: 0;
  padding: 0;
}

.inline-footnote-text {
  font-style: italic; /* Only the text should be italic */
  /* Text will be typed out character by character */
}

/* Full-bleed chapter background image (behind page frame, mobile reader only) */
.page-background-image {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  /* Anchor to the left so the spine/left edge of the scan stays visible */
  object-position: left center;
  z-index: 0;
  pointer-events: none;
}

/* Chapter Progress Bar - Kindle-like thin gray progress bar */
.chapter-progress-bar {
  position: fixed;
  bottom: env(safe-area-inset-bottom, 0px); /* Sit at the very bottom, accounting for safe area */
  left: 0;
  right: 0;
  height: 3.5px;
  background-color: rgba(0, 0, 0, 0.1);
  z-index: 100000; /* Higher than page number to ensure visibility */
  width: 100%;
  /* Ensure visibility on all devices */
  display: block !important;
  visibility: visible !important;
  pointer-events: none; /* Don't interfere with touch events */
}

/* Ensure progress bar is visible on iPhone SE - keep same positioning */
@media screen and (max-height: 667px) and (max-width: 400px) {
  .chapter-progress-bar {
    bottom: env(safe-area-inset-bottom, 0px) !important; /* Same bottom positioning */
    z-index: 100000 !important;
    display: block !important;
    visibility: visible !important;
    height: 4px !important; /* Slightly thicker on small screens for better visibility */
  }
  
  .chapter-progress-fill {
    background-color: rgba(0, 0, 0, 0.4) !important; /* Darker on small screens for better visibility */
  }
}

.chapter-progress-fill {
  height: 100%;
  background-color: rgba(0, 0, 0, 0.3);
  transition: width 0.3s ease;
  width: 0%;
}

