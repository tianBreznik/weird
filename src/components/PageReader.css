.page-reader {
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  background: transparent;
  z-index: 1;
  color: #1f140a;
  font-family: 'Garamond', 'Baskerville', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif;
  /* Force own compositing layer to preserve rendering */
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  will-change: transform;
  /* Prevent any scrolling on the page-frame */
  touch-action: none;
  -webkit-overflow-scrolling: none;
}

.page-container {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 2rem 1.5rem 0.5rem;
  box-sizing: border-box;
  overflow: hidden;
  /* Force own compositing layer that persists during overlays */
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  will-change: transform;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  isolation: isolate;
  /* Prevent scrolling */
  touch-action: none;
}

/* Remove padding for video pages */
.page-container:has(.video-page) {
  padding: 0;
}

.page-sheet {
  width: min(640px, 94vw);
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1.2rem;
  text-align: center;
  font-family: 'Iowan Old Style', 'Baskerville', 'Baskerville Old Face', 'Garamond', 'Cormorant Garamond', serif;
  color: #1b1209;
  /* Lock layout to prevent re-measurement during overlays */
  contain: layout style;
  min-width: 0;
  max-width: min(640px, 94vw);
  box-sizing: border-box;
}

.page-sheet.content-page {
  align-items: flex-start;
  gap: 0.4rem;
  text-align: left;
  width: min(660px, 94vw);
  /* Lock layout to prevent re-measurement during overlays */
  contain: layout style;
  min-width: 0;
  max-width: min(660px, 94vw);
  box-sizing: border-box;
}

.page-header {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 0.45rem;
  text-align: center;
  color: #16100a;
}

.page-title {
  font-size: clamp(2.15rem, 5vw, 2.8rem);
  letter-spacing: 0.04em;
  font-weight: 500;
}

.page-subtitle {
  font-size: clamp(0.95rem, 2.7vw, 1.15rem);
  letter-spacing: 0.18em;
  text-transform: uppercase;
  color: #534b3b;
}

.page-author {
  font-size: clamp(1rem, 2.8vw, 1.2rem);
  font-style: italic;
  color: #3c3427;
}

.page-ampersand {
  font-size: 2.1rem;
  color: #40392f;
  margin-top: 0.1rem;
}

.page-body {
  width: 100%;
  flex: 1;
  line-height: 1.62;
  font-size: 1.18rem;
  letter-spacing: 0.006em;
  padding: 0.5rem 0 0 0;
  position: relative;
  overflow: hidden;
  /* Prevent scrolling */
  touch-action: none;
  -webkit-overflow-scrolling: none;
}


.content-page .page-body {
  text-align: left; /* Left-align like in the image */
  word-spacing: normal;
  hyphens: auto;
  -webkit-hyphens: auto;
  -moz-hyphens: auto;
  hyphenate-limit-chars: 6 3 2; /* min word length, min before hyphen, min after */
  position: relative; /* Allow absolute positioning of footnotes within page-body */
}

.content-page.page-with-heading .page-body {
  padding-top: calc(2.8rem + env(safe-area-inset-top));
  padding-bottom: env(safe-area-inset-bottom);
}

.content-page.page-without-heading .page-body {
  padding-top: calc(1.15rem + env(safe-area-inset-top));
  padding-bottom: env(safe-area-inset-bottom);
}

.content-body::before {
  display: none;
}

.page-content {
  width: 100%;
  font-family: 'Times New Roman', 'Times', 'Garamond', 'Baskerville', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif;
  font-size: 1.18rem; /* Fixed font size - never dynamic */
  line-height: 1.62; /* Fixed line height - never dynamic */
  word-spacing: normal;
  letter-spacing: 0.006em; /* Match page-body letter-spacing */
  /* Prevent layout shifts from overlays */
  contain: layout style;
  /* Lock dimensions to prevent re-measurement */
  min-width: 0;
  max-width: 100%;
  box-sizing: border-box;
  /* Don't create positioning context - footnotes position relative to page-body */
  padding-bottom: 0; /* No padding, footnotes will be absolutely positioned */
  height: 100%; /* Fill parent height */
}

.page-content * {
  font-size: inherit; /* All child elements inherit the same fixed font size */
  font-family: 'Times New Roman', 'Times', 'Garamond', 'Baskerville', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif !important; /* Force Times New Roman on all elements */
}

/* Ink effect for irregular shadows - JavaScript applies via .ink-char-mobile spans */
.ink-char-mobile {
  display: inline;
  font: inherit;
  color: inherit;
  line-height: inherit;
  letter-spacing: inherit;
  /* Preserve rendering during overlays */
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
}

.ink-char-mobile[data-ink="1"] {
  /* Slightly more intense; use currentColor so shadow matches text color */
  /* Use !important to ensure shadows persist during transitions and overlays */
  text-shadow:
    0 0 0.2px currentColor,
    0 0.06px 0.28px currentColor,
   -0.06px 0 0.28px currentColor !important;
  -webkit-text-stroke: 0.06px currentColor !important;
  /* Force hardware acceleration and preserve rendering */
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  will-change: text-shadow;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

/* Exclude chapter and subchapter headings from Times New Roman */
.page-content .chapter-header-title,
.page-content h3.chapter-header-title,
.page-content h4.chapter-header-title {
  font-family: 'Garamond', 'Baskerville', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif !important; /* Keep original font for headings - override universal rule */
}

/* Subchapter titles (h4) should be italic and not bold */
.page-content h4.chapter-header-title {
  font-style: italic !important;
  font-weight: normal !important;
}

.page-content-main {
  width: 100%;
  padding-bottom: 0; /* Will be set dynamically via inline style */
}

/* Default chapter body style (canonical reading style)
   - Approx 18px text
   - Tight line-height (~1.2)
   - Compact vertical rhythm between paragraphs
*/
.page-content p {
  font-size: 1.125rem;         /* ~18px at 16px root */
  line-height: 1.2;
  margin: 0.45rem 0;           /* slightly tighter than before for a more compact, typeset feel */
  text-align: left;            /* Left-align paragraphs like in the reference image */
  word-spacing: normal;
  font-family: 'Times New Roman', 'Times', 'Garamond', 'Baskerville', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif !important; /* Explicit font for paragraphs */
}

.page-content p.para-intro {
  /* Subtle intro/lead paragraph style: slightly more air and light emphasis */
  margin-top: 0.9rem;
  margin-bottom: 0.9rem;
  font-style: italic;
}

.page-content p.para-whisper {
  /* Whisper/aside: a bit smaller, indented and softened */
  font-size: 0.9em;
  line-height: 1.4;
  font-style: italic;
  color: #777;
  opacity: 0.95;
  margin-top: 0.3em;
  margin-bottom: 0.3em;
}

.page-content p.para-epigraph {
  /* Epigraph paragraph style (legacy, for paragraphs in content) */
  text-align: center;
  font-style: italic;
  font-size: 3.95em;
  line-height: 1.5;
  color: #555;
  margin-top: 1.5em;
  margin-bottom: 1.5em;
  padding: 0 1em;
}

/* Epigraph page styling */
.epigraph-page .page-body {
  display: flex;
  /* Push epigraph block toward the bottom of the frame */
  align-items: flex-end;
  justify-content: flex-start;
  text-align: center;
  padding-bottom: 11.5rem; /* lift it slightly above the very bottom edge */
  padding-left: 8rem
}

.epigraph-content {
  width: 100%;
  display: flex;
  /* Anchor block on the left side */
  align-items: flex-end;
  justify-content: flex-start;
  padding: 0 1.5rem;
  box-sizing: border-box;
}

.epigraph-text {
  font-family: 'Garamond', 'Baskerville', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif;
  font-size: 1.2rem;
  line-height: 1.2;
  font-style: italic;
  color: #1f140a;
  max-width: 100%;
  white-space: pre-wrap;
  text-align: left;
}

.epigraph-text > div {
  white-space: pre-wrap;
}

.epigraph-author {
  margin-top: 0.35rem;
  font-size: 0.95rem;
  font-style: normal;
  text-align: right;
}

.epigraph-align-left {
  text-align: left;
}

.epigraph-align-center {
  text-align: center;
}

.epigraph-align-right {
  text-align: right;
}

/* Video page styling - break out of container to cover full screen */
.video-page {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  width: 100vw !important;
  height: 100vh !important;
  max-width: 100vw !important;
  padding: 0 !important;
  margin: 0 !important;
  align-items: stretch;
  z-index: 1;
}

.video-page .page-body {
  padding: 0;
  overflow: hidden;
  position: relative;
  width: 100vw;
  height: 100vh;
  flex: 1;
  min-height: 0;
}

.video-content {
  width: 100vw;
  height: 100vh;
  position: relative;
  padding: 0;
  margin: 0;
  flex: 1;
  min-height: 0;
}

.fullscreen-video {
  width: 100vw;
  height: 100vh;
  object-fit: cover;
  position: absolute;
  top: 0;
  left: 0;
  z-index: 0;
}

/* Video play button - glowing text with floating animation */
.video-play-button {
  position: fixed !important;
  top: 50% !important;
  left: 50% !important;
  transform: translate(-50%, -50%);
  background: transparent;
  border: none;
  color: white;
  font-size: 1.5rem;
  font-weight: 300;
  letter-spacing: 0.1em;
  display: flex !important;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 9999 !important;
  transition: all 0.3s ease;
  padding: 0;
  opacity: 0.9;
  text-shadow: 
    0 0 10px rgba(255, 255, 255, 0.8),
    0 0 20px rgba(255, 255, 255, 0.6),
    0 0 30px rgba(255, 255, 255, 0.4);
  animation: float 3s ease-in-out infinite;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  pointer-events: auto !important;
  visibility: visible !important;
}

@keyframes float {
  0%, 100% {
    transform: translate(-50%, -50%) translateY(0px);
  }
  50% {
    transform: translate(-50%, -50%) translateY(-8px);
  }
}

.video-play-button:hover {
  opacity: 1;
  text-shadow: 
    0 0 15px rgba(255, 255, 255, 1),
    0 0 25px rgba(255, 255, 255, 0.8),
    0 0 35px rgba(255, 255, 255, 0.6);
}

.video-play-button:active {
  transform: translate(-50%, -50%) translateY(-4px) scale(0.95);
}

/* Background video page styling */
.background-video-page .page-body {
  position: relative;
  overflow: hidden;
  width: 100%;
  height: 100%;
}

.background-video {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  object-fit: cover;
  z-index: 0;
}

.background-video-text {
  position: relative;
  z-index: 1;
  color: #ffffff;
}

.background-video-text * {
  color: #ffffff !important;
}

.background-video-text p,
.background-video-text h3,
.background-video-text h4,
.background-video-text h5,
.background-video-text h6 {
  color: #ffffff !important;
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
}

.page-content div.poetry {
  /* Poetry: centered, preserves line breaks, treated as atomic for pagination */
  text-align: center;
  font-style: italic;
  margin: 1.5em 0;
  padding: 0 1em;
}

.page-content div.poetry p {
  margin: 0.3em 0;
  line-height: 1.6;
}

.page-content p:last-child {
  margin-bottom: 0;
}

.page-content ul,
.page-content ol {
  padding-left: 1.4rem;
  margin: 0.45rem 0;           /* Match compact paragraph rhythm */
}

.page-content li {
  font-size: 1.125rem;
  line-height: 1.2;
  margin-bottom: 0.35rem;
}

/* Blockquote styling - book-like with left border and italic text */
.page-content blockquote {
  font-size: 1.125rem;
  line-height: 1.4;
  margin: 0.75rem 0;
  padding-left: 1.5rem;
  border-left: 3px solid #8b8b8b;
  font-style: italic;
  color: #3a3a3a;
  font-family: 'Times New Roman', 'Times', 'Garamond', 'Baskerville', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif !important;
}

/* Drop cap styling - first letter larger */
.page-content p.drop-cap {
  /* Ensure the paragraph itself is block-level for ::first-letter to work */
  display: block;
}

.page-content p.drop-cap::first-letter {
  float: left;
  font-size: 3rem !important;
  line-height: 0.82 !important;
  padding-right: 0.22rem;
  padding-top: 0.08rem;
  font-weight: 400 !important;
  font-family: 'Times New Roman', 'Times', 'Garamond', 'Baskerville', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif !important;
  /* Override any inline styles on the first letter */
  color: inherit !important;
  text-transform: none !important;
}

/* Image alignment and text wrapping */
.page-content img {
  max-width: 100%;
  height: auto;
}

/* Center aligned images (default) - block, no wrap */
.page-content img[data-align="center"] {
  display: block;
  margin: 0.5em auto;
  float: none !important;
}

/* Images without data-align should also be centered */
.page-content img:not([data-align]) {
  display: block;
  margin: 0.5em auto;
  float: none !important;
}

/* Left aligned images - float left, text wraps right */
.page-content img[data-align="left"] {
  float: left !important;
  margin-right: 1em !important;
  margin-bottom: 0.5em !important;
  margin-top: 0.5em !important;
  display: block !important;
}

/* Right aligned images - float right, text wraps left */
.page-content img[data-align="right"] {
  float: right !important;
  margin-left: 1em !important;
  margin-bottom: 0.5em !important;
  margin-top: 0.5em !important;
  display: block !important;
}

/* Inline images - flow with text like an emoji or icon */
.page-content img[data-align="inline"] {
  display: inline-block;
  vertical-align: middle;
  margin: 0 0.25em;
  /* Remove any block-level spacing that might break line flow */
  margin-top: 0;
  margin-bottom: 0;
  /* Note: Best for small images (icons, emojis). Large images will break line flow naturally. */
}

/* Inline image node - true inline images that flow with text */
.page-content img[data-inline="true"] {
  display: inline-block !important;
  vertical-align: middle !important;
  /* Match surrounding text size: 1em relative to current font-size */
  max-height: 1em !important;
  width: auto !important;
  height: auto !important;
  margin: 0 0.25em !important;
  margin-top: 0 !important;
  margin-bottom: 0 !important;
  /* Ensure it doesn't break line flow */
  float: none !important;
  clear: none !important;
}

/* Clear floats after images to prevent layout issues */
.page-content::after {
  content: "";
  display: table;
  clear: both;
}

/* Indented paragraphs */
.page-content p[data-indent],
.page-content h1[data-indent],
.page-content h2[data-indent],
.page-content h3[data-indent] {
  /* Indent is applied via inline style from TipTap */
}

/* Chapter and subchapter title styling - match original Chapter.css styling */
.page-content .chapter-header-title,
.page-content h3.chapter-header-title {
  margin: 1.5rem 0 1rem 0;
  font-size: 1.35rem;
  color: #0c0c0c;
  font-weight: 520;
  font-family: 'Garamond', 'Baskerville', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif;
  text-transform: none;
  letter-spacing: 0.015em;
  text-align: center;
  text-shadow: 0 0 0.9px rgba(0,0,0,0.5), 0 0 1.4px rgba(0,0,0,0.18);
  -webkit-text-stroke: 0.2px rgba(0,0,0,0.22);
}

.page-content .chapter-header-title::first-letter {
  text-transform: uppercase;
}

/* Subchapter titles (h4) */
.page-content h4.chapter-header-title {
  font-size: 1.05rem;
  margin: 1.2rem 0 0.8rem 0;
}

/* Fade transition - smoother and slower */
.page-container .page-sheet {
  opacity: 1;
  transition: opacity 1s ease-in-out;
  will-change: opacity; /* Optimize for opacity transitions */
  /* Preserve text shadows during overlays - create isolated compositing layer */
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  isolation: isolate;
  contain: layout style paint;
}

.page-container.transitioning .page-sheet {
  opacity: 0;
  transition: opacity 1s ease-in-out;
}

/* Preserve ink effect shadows during transition - ensure they fade with text */
/* Apply to all states to ensure consistency */
.page-container .page-sheet .ink-char-mobile[data-ink="1"],
.page-container.transitioning .page-sheet .ink-char-mobile[data-ink="1"] {
  /* Shadows must persist - use !important to override any other rules */
  /* These shadows will fade naturally with the parent's opacity transition */
  /* Match the base shadow values to ensure consistency */
  text-shadow:
    0 0 0.2px currentColor,
    0 0.06px 0.28px currentColor,
   -0.06px 0 0.28px currentColor !important;
  -webkit-text-stroke: 0.06px currentColor !important;
}

.page-reader-loading {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100vh;
  width: 100vw;
  position: fixed;
  top: 0;
  left: 0;
  z-index: 10000;
  background: transparent; /* Use body background (speckled texture) */
  font-family: 'Garamond', 'Baskerville', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif;
  color: #0a0a0a;
  font-size: 1rem;
}

/* Page number in bottom right corner */
.page-number {
  position: fixed;
  bottom: calc(env(safe-area-inset-bottom, 0px) + 2rem + 1rem); /* Same as footnotes padding + original offset */
  right: 1rem;
  font-family: 'Garamond', 'Baskerville', 'Caslon', 'Hoefler Text', 'Minion Pro', 'Palatino', 'Georgia', serif;
  font-size: 0.9rem;
  color: #1f140a;
  opacity: 0.6;
  z-index: 100;
  padding: 0.25rem 0.5rem;
  pointer-events: none;
}

/* Desktop: hide page reader */
/* Karaoke highlighting styles */
.karaoke-slice .karaoke-char,
.karaoke-player .karaoke-char,
.karaoke-slice .karaoke-word,
.karaoke-player .karaoke-word {
  position: relative;
  display: inline-block;
  white-space: pre;
  color: inherit;
  --karaoke-fill: 0;
  font: inherit;
  line-height: inherit;
  letter-spacing: inherit;
  text-shadow: none;
  -webkit-text-stroke: none;
}

.karaoke-slice .karaoke-char[data-ink="1"],
.karaoke-player .karaoke-char[data-ink="1"],
.karaoke-slice .karaoke-word[data-ink="1"],
.karaoke-player .karaoke-word[data-ink="1"] {
  text-shadow:
    0 0 0.8px rgba(0,0,0,0.5),
    0 0.25px 1px rgba(0,0,0,0.22),
   -0.25px 0 1px rgba(0,0,0,0.18);
  -webkit-text-stroke: 0.2px rgba(0,0,0,0.22);
}

.karaoke-slice .karaoke-char::after,
.karaoke-player .karaoke-char::after {
  content: attr(data-char);
  position: absolute;
  inset: 0;
  white-space: pre;
  color: transparent;
  pointer-events: none;
  opacity: var(--karaoke-fill);
  font: inherit;
  letter-spacing: inherit;
  line-height: inherit;
  font-weight: inherit;
  -webkit-text-stroke: 0.75px rgba(255, 214, 0, 0.95);
  text-shadow: none;
  transition: opacity 90ms linear;
}

.karaoke-slice .karaoke-word::after,
.karaoke-player .karaoke-word::after {
  content: attr(data-word);
  position: absolute;
  inset: 0;
  white-space: pre;
  color: transparent;
  pointer-events: none;
  opacity: var(--karaoke-fill);
  font: inherit;
  letter-spacing: inherit;
  line-height: inherit;
  font-weight: inherit;
  -webkit-text-stroke: 0.75px rgba(255, 214, 0, 0.95);
  text-shadow: none;
  transition: opacity 90ms linear;
}

.karaoke-slice .karaoke-char.karaoke-char-complete,
.karaoke-slice .karaoke-char.karaoke-char-active,
.karaoke-player .karaoke-char.karaoke-char-complete,
.karaoke-player .karaoke-char.karaoke-char-active,
.karaoke-slice .karaoke-word.karaoke-word-complete,
.karaoke-slice .karaoke-word.karaoke-word-active,
.karaoke-player .karaoke-word.karaoke-word-complete,
.karaoke-player .karaoke-word.karaoke-word-active {
  color: inherit;
}

/* Breathing pulse animation for karaoke slices */
.karaoke-slice {
  cursor: pointer;
  display: inline-block;
  animation: karaoke-breathe 2s ease-in-out infinite;
  will-change: opacity;
  /* Disable hyphenation for karaoke text to prevent word breaking issues */
  hyphens: none;
  -webkit-hyphens: none;
  -moz-hyphens: none;
}

/* Prevent line breaks after word spans that contain punctuation */
.karaoke-word:has(.karaoke-punctuation) {
  white-space: nowrap;
}

.karaoke-slice[data-playing="true"] {
  animation: none !important;
  opacity: 1 !important;
}

.karaoke-slice .karaoke-char {
  animation: inherit;
}

.karaoke-slice[data-playing="true"] .karaoke-char {
  animation: none !important;
}

@keyframes karaoke-breathe {
  0%, 100% {
    opacity: 0.35;
  }
  50% {
    opacity: 1;
  }
}

@media (min-width: 769px) {
  .page-reader {
    display: none;
  }
}

/* Footnote styles */
.footnote-ref {
  font-size: 0.75em;
  vertical-align: super;
  line-height: 0;
  cursor: pointer;
  color: #1f140a;
  text-decoration: none;
  margin-left: 0.1em;
}

.footnote-ref:hover {
  text-decoration: underline;
}

.footnotes-section {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  margin-top: 0;
  padding-top: 0;
  padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 2rem + 1rem); /* Account for browser bar on mobile + extra padding to lift footnotes up */
  margin-bottom: 0;
  border-top: none; /* Remove border-top, we use .footnotes-divider instead */
  background: inherit; /* Match page background */
  z-index: 1; /* Ensure footnotes are above content if needed */
}

.footnotes-divider {
  height: 1px;
  background: linear-gradient(to right, rgba(31, 20, 10, 0.3) 0%, rgba(31, 20, 10, 0.1) 100%);
  margin-bottom: 0.3rem;
  margin-top: 0;
}

.footnotes-list {
  font-size: 0.9rem;
  line-height: 1.5;
  color: #1f140a;
}

.footnote-item {
  margin-bottom: 0.3rem;
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
}

.footnote-item:last-child {
  margin-bottom: 0;
}

.footnote-number {
  font-weight: 500;
  flex-shrink: 0;
  min-width: 1.5em;
}

.footnote-content {
  flex: 1;
}

